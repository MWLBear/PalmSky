# æŽŒä¸Šä¿®ä»™ï¼šè…•ä¸Šå¤©é“ - é¡¹ç›®è¯´æ˜Žæ–‡æ¡£

## ðŸ“± é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªä¸“ä¸º Apple Watch è®¾è®¡çš„æžç®€ä¿®ä»™æ”¾ç½®ç±»æ¸¸æˆï¼Œå®Œå…¨æŒ‰ç…§ç­–åˆ’æ¡ˆå®žçŽ°äº† 144 çº§å¢ƒç•Œç³»ç»Ÿã€å¥‡é‡äº‹ä»¶ã€è‡ªåŠ¨å¢žé•¿ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ðŸ—‚ï¸ é¡¹ç›®ç»“æž„

```
XiuxianWatch/
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ GameConstants.swift          # æ¸¸æˆå¸¸é‡é…ç½®
â”‚   â”œâ”€â”€ Player.swift                  # çŽ©å®¶æ•°æ®æ¨¡åž‹
â”‚   â”œâ”€â”€ GameEvent.swift               # äº‹ä»¶æ•°æ®æ¨¡åž‹
â”‚   â””â”€â”€ GameLevelManager.swift        # ç­‰çº§ç®¡ç†å™¨ï¼ˆæ ¸å¿ƒå…¬å¼ï¼‰
â”‚
â”œâ”€â”€ Managers/
â”‚   â”œâ”€â”€ GameManager.swift             # æ¸¸æˆæ ¸å¿ƒç®¡ç†å™¨
â”‚   â”œâ”€â”€ HapticManager.swift           # éœ‡åŠ¨åé¦ˆç®¡ç†
â”‚   â””â”€â”€ EventPool.swift               # äº‹ä»¶æ± ï¼ˆ12ä¸ªé¢„è®¾å¥‡é‡ï¼‰
â”‚
â”œâ”€â”€ Views/
â”‚   â”œâ”€â”€ MainView.swift                # ä¸»ç•Œé¢ï¼ˆå¤ªæžå›¾ + è¿›åº¦ï¼‰
â”‚   â”œâ”€â”€ EventView.swift               # å¥‡é‡å¼¹çª—
â”‚   â”œâ”€â”€ BreakthroughView.swift        # çªç ´ç•Œé¢
â”‚   â”œâ”€â”€ SettingsView.swift            # è®¾ç½®ç•Œé¢
â”‚   â””â”€â”€ Components/
â”‚       â””â”€â”€ TaijiView.swift           # å¤ªæžå›¾ç»„ä»¶
â”‚
â”œâ”€â”€ Complications/
â”‚   â”œâ”€â”€ ComplicationProvider.swift    # è¡¨ç›˜æ•°æ®æä¾›è€…
â”‚   â””â”€â”€ ComplicationViews.swift       # å„ç§è¡¨ç›˜æ ·å¼
â”‚
â””â”€â”€ App/
    â””â”€â”€ XiuxianApp.swift              # App å…¥å£
```

## ðŸŽ® æ ¸å¿ƒåŠŸèƒ½å®žçŽ°

### 1. æ•°å€¼ç³»ç»Ÿï¼ˆGameLevelManagerï¼‰

#### 16 å¤§å¢ƒç•Œï¼ˆ144 å±‚ï¼‰
```
ç­‘åŸº â†’ å¼€å…‰ â†’ èƒŽæ¯ â†’ è¾Ÿè°· â†’ é‡‘ä¸¹ â†’ å…ƒå©´ â†’ å‡ºçª â†’ åˆ†ç¥ž
â†’ åˆä½“ â†’ å¤§ä¹˜ â†’ æ¸¡åŠ« â†’ åœ°ä»™ â†’ å¤©ä»™ â†’ é‡‘ä»™ â†’ å¤§ç½—é‡‘ä»™ â†’ ä¹å¤©çŽ„ä»™
```

#### æ ¸å¿ƒå…¬å¼
```swift
// ç‚¹å‡»æ”¶ç›Š
tapGain = 5.0 Ã— (1.25 ^ stage) Ã— (1.0 + 0.05 Ã— (floor - 1))

// è‡ªåŠ¨æ”¶ç›Š
autoGain = tapGain Ã— 0.30

// çªç ´æ¶ˆè€—
breakCost = 50.0 Ã— (1.15 ^ level)

// æˆåŠŸçŽ‡
breakSuccess = max(0.6, 0.95 - level Ã— 0.0023)
```

### 2. æ¸¸æˆå¾ªçŽ¯ï¼ˆGameManagerï¼‰

```swift
// æ¯ç§’æ›´æ–°
func tick(deltaSeconds: Double) {
    // 1. è‡ªåŠ¨å¢žé•¿çµåŠ›
    currentQi += autoGain(level) Ã— deltaSeconds
    
    // 2. æ£€æŸ¥çªç ´æ¡ä»¶
    if currentQi >= breakCost(level) {
        showBreakButton = true
    }
    
    // 3. æ¯ 10 ç§’æ£€æŸ¥å¥‡é‡ï¼ˆ2.5% æ¦‚çŽ‡ï¼‰
}

// ç‚¹å‡»
func onTap() {
    currentQi += tapGain(level)
    playHaptic(.light)
}

// çªç ´
func attemptBreak() -> Bool {
    if random() <= breakSuccess(level) {
        level += 1  // æˆåŠŸ
        currentQi -= breakCost
        return true
    } else {
        currentQi Ã— = 0.9  // å¤±è´¥æƒ©ç½š
        return false
    }
}
```

### 3. äº‹ä»¶ç³»ç»Ÿï¼ˆEventPoolï¼‰

12 ä¸ªé¢„è®¾å¥‡é‡ï¼š
- **æ­£é¢äº‹ä»¶**ï¼šå±±é—´çµæ³‰ã€é“å‹ç›¸èµ ã€å¤æ´žåºœã€çµè‰é‡‡é›†ã€å¤©é™å¼‚è±¡ã€ä»™äººæŒ‡ç‚¹ã€çµçŸ³çŸ¿è„‰ã€ç¥žç§˜å•†äººã€é›·åŠ«ä¹‹åŠ›
- **è´Ÿé¢äº‹ä»¶**ï¼šå¦–å…½è¢­å‡»ã€é­”æ—æŒ‘è¡…ã€å¿ƒé­”è€ƒéªŒ

äº‹ä»¶ç±»åž‹ï¼š
- `gain_qi`: å¢žåŠ çµæ°”
- `lose_qi`: å‡å°‘çµæ°”
- `grant_item`: èŽ·å¾—é“å…·
- `nothing`: æ— æ•ˆæžœ

### 4. UI ç•Œé¢

#### MainViewï¼ˆä¸»ç•Œé¢ï¼‰
- å¤ªæžå›¾ï¼ˆå¯ç‚¹å‡»ï¼‰
- å½“å‰å¢ƒç•Œæ˜¾ç¤º
- è¿›åº¦æ¡ï¼ˆçµæ°”/æ‰€éœ€çµæ°”ï¼‰
- çªç ´æŒ‰é’®ï¼ˆæ¡ä»¶è¾¾æˆæ—¶æ˜¾ç¤ºï¼‰
- è®¾ç½®å…¥å£

#### EventViewï¼ˆå¥‡é‡ï¼‰
- æ ‡é¢˜ + æè¿°ï¼ˆ< 80 å­—ï¼‰
- ä¸¤ä¸ªé€‰é¡¹ï¼ˆA/Bï¼‰
- æ˜¾ç¤ºæ•ˆæžœæç¤ºï¼ˆÂ±çµæ°”ï¼‰

#### BreakthroughViewï¼ˆçªç ´ï¼‰
- æ˜¾ç¤ºæˆåŠŸçŽ‡
- èƒ½é‡åœˆåŠ¨ç”»
- ç»“æžœåé¦ˆï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰

#### SettingsViewï¼ˆè®¾ç½®ï¼‰
- éœ‡åŠ¨å¼€å…³
- è‡ªåŠ¨å¢žé•¿å¼€å…³
- æ•°å€¼è¯¦æƒ…å±•ç¤º
- é‡ç½®æ•°æ®ï¼ˆéœ€ç¡®è®¤ï¼‰

### 5. è¡¨ç›˜ Complication

æ”¯æŒå¤šç§æ ·å¼ï¼š
- **Circular**: åœ†å½¢è¿›åº¦åœˆ + å¢ƒç•Œå
- **Modular**: æ¨ªæ¡è¿›åº¦ + ç™¾åˆ†æ¯”
- **Corner**: ç´§å‡‘è§’è½æ ·å¼
- **Inline**: å•è¡Œæ–‡å­—

æ›´æ–°ç­–ç•¥ï¼š
- æ¯ 30 åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°
- è¿›åº¦ â‰¥ 90% æ—¶å¯é¢å¤–åˆ·æ–°
- ç‚¹å‡» Complication æ‰“å¼€ App

## ðŸ”§ å…³é”®æŠ€æœ¯ç‚¹

### æ•°æ®æŒä¹…åŒ–
```swift
// ä½¿ç”¨ UserDefaults å­˜å‚¨
func savePlayer() {
    let encoder = JSONEncoder()
    if let data = try? encoder.encode(player) {
        UserDefaults.standard.set(data, forKey: "savedPlayer")
    }
}

// è‡ªåŠ¨ä¿å­˜ï¼ˆæ¯ 30 ç§’ï¼‰+ é€€å‡ºæ—¶ä¿å­˜
```

### éœ‡åŠ¨åé¦ˆ
```swift
#if os(watchOS)
import WatchKit

func play(_ type: HapticType) {
    switch type {
    case .light:
        WKInterfaceDevice.current().play(.click)
    case .success:
        WKInterfaceDevice.current().play(.success)
    case .error:
        WKInterfaceDevice.current().play(.failure)
    }
}
#endif
```

### å®šæ—¶å™¨ç®¡ç†
```swift
// Auto gain timer
timer = Timer.scheduledTimer(withTimeInterval: 1.0, repeats: true) { _ in
    self.tick(deltaSeconds: 1.0)
}

// Event check timer
eventTimer = Timer.scheduledTimer(withTimeInterval: 10.0, repeats: true) { _ in
    self.checkForEvent()
}

// è®°å¾—åœ¨ pauseGame() æ—¶ invalidate
```

## ðŸ“Š æ•°å€¼è°ƒä¼˜

æ‰€æœ‰å…³é”®å‚æ•°éƒ½åœ¨ `GameConstants` ä¸­ï¼š

```swift
struct GameConstants {
    // åŸºç¡€æ”¶ç›Š
    static let BASE_GAIN = 5.0
    static let AUTO_GAIN_RATIO = 0.30
    
    // æˆé•¿æ›²çº¿
    static let STAGE_POWER = 1.25          // å¢ƒç•Œå€çŽ‡
    static let FLOOR_STEP_RATIO = 0.05     // å±‚æ¬¡å¢žé•¿
    static let BREAK_COST_FACTOR = 1.15    // æ¶ˆè€—æŒ‡æ•°
    
    // æˆåŠŸçŽ‡
    static let BREAK_SUCCESS_LOWER = 0.6   // æœ€ä½Ž 60%
    
    // äº‹ä»¶é¢‘çŽ‡
    static let EVENT_CHECK_INTERVAL = 10.0  // æ¯ 10 ç§’æ£€æŸ¥
    static let EVENT_PROBABILITY = 0.025    // 2.5% æ¦‚çŽ‡
}
```

### å…¸åž‹æ•°å€¼ç¤ºä¾‹

| ç­‰çº§ | å¢ƒç•Œ | ç‚¹å‡»æ”¶ç›Š | è‡ªåŠ¨/ç§’ | çªç ´æ¶ˆè€— | æˆåŠŸçŽ‡ |
|------|------|----------|---------|----------|--------|
| 1 | ç­‘åŸº 1å±‚ | 5.0 | 1.5 | 57.5 | 95% |
| 10 | ç­‘åŸº 10å±‚â†’å¼€å…‰ 1å±‚ | 7.0 | 2.1 | 202.3 | 93% |
| 30 | èƒŽæ¯ 3å±‚ | 14.9 | 4.5 | 3310 | 88% |
| 72 | å‡ºçª 9å±‚ | 76.2 | 22.9 | ~100K | 78% |
| 144 | ä¹å¤©çŽ„ä»™ 9å±‚ | 2580 | 774 | ~82M | 60% |

## ðŸš€ ç¼–è¯‘ä¸Žè¿è¡Œ

### çŽ¯å¢ƒè¦æ±‚
- Xcode 15.0+
- watchOS 10.0+
- Swift 5.9+

### ç¼–è¯‘æ­¥éª¤
1. åˆ›å»ºæ–°çš„ watchOS App é¡¹ç›®
2. å°†æ‰€æœ‰ä»£ç æ–‡ä»¶æŒ‰ç»“æž„æ”¾å…¥é¡¹ç›®
3. é…ç½® Info.plistï¼ˆæ·»åŠ  WidgetKit æ”¯æŒï¼‰
4. é€‰æ‹© watchOS æ¨¡æ‹Ÿå™¨æˆ–çœŸæœº
5. Build & Run

### æ³¨æ„äº‹é¡¹
- Complication éœ€è¦åœ¨ Info.plist æ·»åŠ  `CLKComplicationPrincipalClass`
- ç¡®ä¿åœ¨ Capabilities ä¸­å¯ç”¨ Background Modesï¼ˆå¦‚éœ€åŽå°ï¼‰
- çœŸæœºæµ‹è¯•éœ‡åŠ¨æ•ˆæžœï¼ˆæ¨¡æ‹Ÿå™¨æ— éœ‡åŠ¨ï¼‰

## ðŸŽ¯ åŽç»­ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸï¼ˆv1.1ï¼‰
- [ ] æ·»åŠ éŸ³æ•ˆå¼€å…³
- [ ] æ›´å¤šå¥‡é‡äº‹ä»¶ï¼ˆæ‰©å±•åˆ° 30+ï¼‰
- [ ] æˆå°±ç³»ç»Ÿï¼ˆé¦–æ¬¡çªç ´ã€è¿žç»­çªç ´ç­‰ï¼‰
- [ ] æ•°æ®ç»Ÿè®¡ï¼ˆæ€»ä¿®ç‚¼æ—¶é—´ã€çªç ´æ¬¡æ•°ï¼‰

### ä¸­æœŸï¼ˆv1.2ï¼‰
- [ ] å¤©èµ‹ç³»ç»Ÿï¼ˆ3-5 ä¸ªè¢«åŠ¨å¤©èµ‹ï¼‰
- [ ] èƒŒåŒ…ç³»ç»Ÿï¼ˆæ¶ˆè€—å“ã€è£…å¤‡ï¼‰
- [ ] è¡¨å† å°æ¸¸æˆï¼ˆå¯é€‰å¼€å¯ï¼‰
- [ ] iCloud åŒæ­¥

### é•¿æœŸï¼ˆv2.0ï¼‰
- [ ] å¤šè§’è‰²ç³»ç»Ÿ
- [ ] ç¤¾äº¤åŠŸèƒ½ï¼ˆæŽ’è¡Œæ¦œï¼‰
- [ ] å‰§æƒ…æ¨¡å¼
- [ ] æ·±åº¦è‡ªå®šä¹‰ï¼ˆUIä¸»é¢˜ã€æ•°å€¼è°ƒæ•´ï¼‰

## ðŸ› å·²çŸ¥é—®é¢˜

1. **å¤§æ•°å€¼æ˜¾ç¤º**ï¼š144 çº§æ—¶çµæ°”å¯èƒ½è¾¾åˆ°ä¸Šåƒä¸‡ï¼Œéœ€è€ƒè™‘ç§‘å­¦è®¡æ•°æ³•æ˜¾ç¤º
2. **å®šæ—¶å™¨ç²¾åº¦**ï¼šåŽå°æ—¶å®šæ—¶å™¨ä¼šæš‚åœï¼Œå¯è€ƒè™‘ç”¨ç¦»çº¿è¡¥å¿æœºåˆ¶
3. **Complication å»¶è¿Ÿ**ï¼šè¡¨ç›˜æ›´æ–°æœ‰ç³»ç»Ÿé™åˆ¶ï¼Œä¸ä¼šå®žæ—¶åæ˜ 

## ðŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-12-12)
- âœ… å®Œæ•´å®žçŽ° 144 çº§å¢ƒç•Œç³»ç»Ÿ
- âœ… ç‚¹å‡» + è‡ªåŠ¨å¢žé•¿
- âœ… 12 ä¸ªå¥‡é‡äº‹ä»¶
- âœ… çªç ´ç³»ç»Ÿï¼ˆæˆåŠŸçŽ‡åŠ¨æ€ï¼‰
- âœ… è®¾ç½®ç•Œé¢ï¼ˆéœ‡åŠ¨ã€è‡ªåŠ¨ã€é‡ç½®ï¼‰
- âœ… è¡¨ç›˜ Complicationï¼ˆ4 ç§æ ·å¼ï¼‰
- âœ… æ•°æ®æŒä¹…åŒ–
- âœ… å®Œæ•´ UI åŠ¨ç”»

## ðŸ‘¥ å¼€å‘å›¢é˜Ÿ

- ç­–åˆ’ï¼šæ ¹æ®ã€ŠæŽŒä¸Šä¿®ä»™ï¼šè…•ä¸Šå¤©é“ã€‹ç­–åˆ’æ¡ˆ
- å¼€å‘ï¼šClaude (Anthropic)
- å¹³å°ï¼šwatchOS

## ðŸ“„ è®¸å¯è¯

æ­¤ä»£ç ä»…ä¾›å­¦ä¹ å‚è€ƒä½¿ç”¨ã€‚

---

**ç¥ä½ ä¿®ç‚¼é¡ºåˆ©ï¼Œæ—©æ—¥é£žå‡ä¹å¤©ï¼** âœ¨
